# üèó Project Blueprint: NotifyKit

This file contains the "reconstruction blueprint" and critical rules for the NotifyKit project.

## üèó Architecture

- **Library**: Monorepo with `@notify-kit/core` and `@notify-kit/react`.
- **Infrastructure**: Firebase (Functions, FCM, Cloud Tasks).
- **Client**: PWA (Service Worker, IndexedDB fallback).

## LESSONS LEARNED (DO NOT BREAK)

### üö® Critical Implementation Rules

1.  **System Notifications**: ALWAYS use `registration.showNotification()` for all alerts. This ensures the device's native notification system handles sounds and battery optimization correctly.
2.  **Dual Path**: FCM (Primary) + IndexedDB (Fallback). When push arrives, it must cancel the pending device notification to prevent duplicates.
3.  **FCM Payloads**: Use **data-only** payloads. Move `title` and `body` into the `data` object. This prevents the browser from showing a generic notification before the Service Worker processes it.
4.  **Service Worker Templates**: Never edit generated `sw.js` files. Always edit `templates/service-worker/sw.template.js`.

## üõ† Operation & Deployment

### Workflow: Feature Branch ‚Üí Staging ‚Üí Production

```
feature/XX-description  ‚Üí  staging  ‚Üí  main (production)
```

- **Issue Tracking**: Create a GitHub issue before starting work.
- **Commit Format**: Conventional commits (e.g., `feat: #XX description`).
- **Sync Logic**: After merging to main, pull the latest changes locally.

### Documentation-Only Workflow

For changes to documentation, config files, or other non-app files (`.cursorrules`, `CLAUDE.MD`, `README.md`, `.gitignore`, `.env.example`, `.agent/workflows/*.md`):

**Key differences:** No version bump, build, testing, staging, or Firebase deployment.

1. Branch `docs/XX-description`.
2. Make changes, commit, and push.
3. Create PR and merge directly to `main` (skip staging).
   ```bash
   gh pr create --title "#XX Description" --body "Closes #XX"
   gh pr merge --merge --delete-branch
   ```

---

## ü§ù Cross-Agent Coordination

- **Documentation Sync**: When updating `CLAUDE.MD`, `.cursorrules`, or `.agent/workflows/deploy.md`, you MUST check and update the other two files.
- **Commit Permission**: Ask the user before committing changes to rules files.

## ü§ñ Workflow Automation: PR Summaries

- **Trigger**: "pr summary" or "pull request summary".
- **Action**: Return markdown code block in the chat response.
- **Format**:
  ````markdown
  ## üé® [Feature/Fix Title]
  ### Summary
  ...
  ### Changes
  ...
  ### Technical Details
  ...
  ### Testing
  ...
  ````
